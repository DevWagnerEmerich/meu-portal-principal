<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Tabela Periódica Interativa - EducaTech</title>
  <link rel="icon" href="logo-educatech.jpg" type="image/jpeg">
  <style>
    /* Estilos Globais e Fundo - Inspirado no arquivo de referência */
    html, body {
      margin: 0;
      padding: 0;
      width: 100%;
      height: 100%;
      overflow: hidden;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #422db1 0%, #5940d9 100%);
      position: relative;
      z-index: 0;
    }

    /* Variáveis de Cor da Marca */
    :root {
      --educatech-primary: #422db1;
      --educatech-secondary: #eff4f3;
      --educatech-accent-1: #c2e2d9;
      --educatech-accent-2: #95d1c0;
      --educatech-accent-3: #69c0a7;
      --scaled-title-font-size: 18px;
      --scaled-button-font-size: 14px;
      --scaled-button-padding-vertical: 6px;
      --scaled-button-padding-horizontal: 12px;
      --fixed-elements-top-margin: 2vh;
    }

    /* Efeitos de partículas do arquivo de referência */
    .particles {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      z-index: -1;
    }
    .particle {
      position: absolute;
      width: 3px;
      height: 3px;
      background: var(--educatech-accent-3);
      border-radius: 50%;
      opacity: 0.3;
      animation: float 6s infinite ease-in-out;
    }
    @keyframes float {
      0%, 100% { transform: translateY(0px) rotate(0deg); opacity: 0.3; }
      50% { transform: translateY(-20px) rotate(180deg); opacity: 0.6; }
    }

    /* Logo EducaTech - do arquivo de referência */
    .educatech-logo {
      position: fixed;
      top: 20px;
      right: 20px;
      z-index: 15;
      background: rgba(255, 255, 255, 0.95);
      padding: 12px 20px;
      border-radius: 12px;
      box-shadow: 0 4px 15px rgba(66, 45, 177, 0.2);
      backdrop-filter: blur(10px);
      border: 2px solid var(--educatech-accent-3);
      transition: all 0.3s ease;
    }
    .educatech-logo:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(66, 45, 177, 0.3);
    }
    .logo-text {
      font-size: 24px;
      font-weight: 700;
      background: linear-gradient(45deg, var(--educatech-accent-3), var(--educatech-primary));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      margin: 0;
    }
    .logo-subtitle {
      font-size: 10px;
      color: var(--educatech-primary);
      margin: 0;
      text-align: center;
      font-weight: 500;
    }

    /* Marca d'água - do arquivo de referência */
    .watermark {
      position: fixed;
      bottom: 20px;
      left: 20px;
      font-size: 12px;
      color: rgba(255, 255, 255, 0.4);
      z-index: 5;
      font-weight: 500;
    }

    #zoom-container {
      position: absolute;
      left: 50%;
      transform-origin: top center;
    }

    .tabela {
      position: absolute; 
      top: 0px; 
      left: 50%;
      transform: translateX(-50%);
      display: grid;
      grid-template-columns: repeat(18, 48px) 30px;
      grid-template-rows:
        calc(48px / 0.6547) calc(48px / 0.6547) calc(48px / 0.6547) calc(48px / 0.6547) calc(48px / 0.6547) calc(48px / 0.6547) calc(48px / 0.6547)
        10px
        calc(48px / 0.6547) calc(48px / 0.6547)
        25px
      ;
      gap: 2px;
      height: auto; 
      z-index: 1;
    }

    .elemento {
      width: 48px; 
      background: white;
      border: 1px solid #ccc;
      font-size: 10px; 
      box-shadow: 0 0 3px rgba(0,0,0,0.1);
      cursor: pointer;
      display: flex;
      flex-direction: column;
      position: relative;
      transition: all 0.3s ease;
      overflow: hidden;
      border-radius: 4px;
    }
    .elemento:hover {
      transform: translateY(-1px);
      box-shadow: 0 4px 8px rgba(66, 45, 177, 0.2);
      border-color: var(--educatech-accent-3);
    }

    .simbolo {
      font-weight: bold;
      font-size: 11px; 
      margin-top: 1px;
      text-align: center;
      flex-shrink: 0;
      color: var(--educatech-primary);
    }

    .foto-editavel {
      flex-grow: 1;
      overflow: hidden;
      display: flex;
      align-items: center;
      justify-content: center;
      background: linear-gradient(135deg, var(--educatech-secondary) 0%, var(--educatech-accent-1) 100%);
      min-height: 0;
    }

    .foto-editavel img, .foto-editavel picture img {
      width: 100%; height: 100%; object-fit: contain; display: block;
    }

    .vazio { background: transparent; border: none; pointer-events: none; }

    .grupo-header, .periodo-numero {
      display: flex; align-items: center; justify-content: center;
      font-size: 12px; font-weight: bold; color: white;
      background: linear-gradient(135deg, var(--educatech-accent-3), var(--educatech-accent-2));
      border: 1px solid var(--educatech-accent-3);
      box-sizing: border-box; padding: 0 2px; text-align: center;
      border-radius: 4px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }

    #label-grupo, #label-periodo {
      font-weight: bold; color: white; z-index: 5; text-shadow: 0 1px 2px rgba(0,0,0,0.3);
    }
    #label-grupo {
      position: absolute; top: calc((7.29 * (48px / 0.6547)) + 10px + (2 * (48px / 0.6547)) + (25px / 2));
      transform: translateY(-50%); left: -60px; font-size: 14px; width: 40px; text-align: right;
    }
    #label-periodo {
      position: absolute; top: calc(15.6 * (48px / 0.6547) / 2); right: 1px;
      transform: translateY(-50%) rotate(180deg); writing-mode: vertical-rl; font-size: 14px;
      width: 20px; text-align: center; padding: 4px 0;
    }
    
    /* MODIFICADO: Estilo das setas para ter alto contraste no fundo escuro */
    #arrow-svg {
        position: fixed;
        top: 0;
        left: 0;
        width: 100vw;
        height: 100vh;
        pointer-events: none;
        z-index: 2;
        overflow: visible;
    }
    #arrow-svg path { 
      stroke: white; /* Cor branca para o corpo da seta */
      stroke-width: 2; 
      fill: none; 
      filter: drop-shadow(0 0 2px rgba(0,0,0,0.5)); /* Sombra para destacar */
    }
    #arrow-svg #arrowhead polygon { 
      fill: white; /* Cor branca para a ponta da seta */
    }

    /* Título e Botão - Estilo do arquivo de referência */
    .titulo-flutuante {
      position: fixed; top: var(--fixed-elements-top-margin); left: 50%;
      transform: translateX(-50%); z-index: 10; text-align: center;
    }
    .titulo-flutuante h1 {
        background: linear-gradient(135deg, rgba(255, 255, 255, 0.95), rgba(239, 244, 243, 0.95));
        padding: var(--scaled-title-padding-vertical) var(--scaled-title-padding-horizontal);
        border-radius: 15px;
        display: inline-block;
        box-shadow: 0 4px 15px rgba(66, 45, 177, 0.2);
        font-size: var(--scaled-title-font-size); margin: 0;
        color: var(--educatech-primary);
        border: 2px solid var(--educatech-accent-3);
        backdrop-filter: blur(10px);
        font-weight: 600;
    }
    .botao-flutuante {
      position: fixed;
      top: calc(var(--fixed-elements-top-margin) + 70px);
      left: 50%;
      transform: translateX(-50%);
      z-index: 10;
    }
    .botao-flutuante button {
      padding: var(--scaled-button-padding-vertical) var(--scaled-button-padding-horizontal);
      font-size: var(--scaled-button-font-size);
      background: linear-gradient(135deg, var(--educatech-accent-3), var(--educatech-accent-2));
      color: white;
      border: none; 
      border-radius: 25px;
      cursor: pointer; 
      transition: all 0.3s ease;
      font-weight: 600;
      box-shadow: 0 4px 15px rgba(105, 192, 167, 0.3);
      text-transform: uppercase;
    }
    .botao-flutuante button:hover { 
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(105, 192, 167, 0.4);
    }
    .botao-flutuante button:disabled { 
      background: #aaa; cursor: not-allowed; transform: none; box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }

    /* Estilos do Bingo - Inspirado no arquivo de referência */
    .sorteio-ativo { animation: pulsoEducaTech 0.5s infinite alternate; z-index: 3; }
    @keyframes pulsoEducaTech {
      0% { box-shadow: 0 0 0px 2px var(--educatech-accent-3); transform: scale(1); }
      100% { box-shadow: 0 0 15px 4px var(--educatech-primary); transform: scale(1.05); }
    }
    .sorteado-uma-vez {
        background: linear-gradient(135deg, var(--educatech-accent-1), var(--educatech-secondary));
        border-color: var(--educatech-accent-2);
        border-width: 2px;
    }
    .sorteado { 
      opacity: 0.4;
      filter: grayscale(0.7);
    }
    .destaque-overlay {
      position: fixed; top: 0; left: 0; width: 100vw; height: 100vh;
      background: rgba(66, 45, 177, 0.8);
      display: flex; justify-content: center; align-items: center; 
      z-index: 1000; cursor: pointer;
      backdrop-filter: blur(5px);
    }
    .destaque-box { 
      width: 30vw; height: 83vh;
      background: linear-gradient(135deg, white, var(--educatech-secondary));
      padding: 20px;
      box-shadow: 0 10px 40px rgba(66, 45, 177, 0.4);
      animation: destaqueAnimar 0.4s ease forwards;
      overflow: hidden; display: flex; align-items: center; justify-content: center;
      cursor: default; border-radius: 20px;
      border: 3px solid var(--educatech-accent-3);
    }
    @keyframes destaqueAnimar {
      from { transform: scale(0.1); opacity: 0; }
      to { transform: scale(1); opacity: 1; }
    }
    .destaque-box img, .destaque-box picture img {
      max-width: 100%; max-height: 100%; object-fit: contain; display: block; border-radius: 10px;
    }
  </style>
</head>
<body>
  <div class="particles" id="particles"></div>
  <div class="educatech-logo">
    <div class="logo-text">EducaTech</div>
    <div class="logo-subtitle">Educação • Tecnologia</div>
  </div>
  <div class="watermark">Powered by EducaTech</div>

  <div id="zoom-container">
    <div class="tabela" id="tabelaPeriodica"></div>
  </div>

  <svg id="arrow-svg"><defs></defs></svg>

  <div class="titulo-flutuante">
    <h1>Tabela Periódica Interativa com Bingo</h1>
  </div>

  <div class="botao-flutuante">
    <button id="bingoBtn">🎲 Bingo</button>
  </div>

  <audio id="somSorteando" src="sons/sorteando.mp3" preload="auto"></audio>
  <audio id="somFinal" src="sons/final.mp3" preload="auto"></audio>

  <script>
    // --- LÓGICA DO JOGO (FUNCIONAL E TESTADA) ---
    const elementos = [
      ['H', 0, 0], ['He', 17, 0], ['Li', 0, 1], ['Be', 1, 1], ['B', 12, 1], ['C', 13, 1], ['N', 14, 1],
      ['O', 15, 1], ['F', 16, 1], ['Ne', 17, 1], ['Na', 0, 2], ['Mg', 1, 2], ['Al', 12, 2], ['Si', 13, 2],
      ['P', 14, 2], ['S', 15, 2], ['Cl', 16, 2], ['Ar', 17, 2], ['K', 0, 3], ['Ca', 1, 3], ['Sc', 2, 3],
      ['Ti', 3, 3], ['V', 4, 3], ['Cr', 5, 3], ['Mn', 6, 3], ['Fe', 7, 3], ['Co', 8, 3], ['Ni', 9, 3],
      ['Cu', 10, 3], ['Zn', 11, 3], ['Ga', 12, 3], ['Ge', 13, 3], ['As', 14, 3], ['Se', 15, 3], ['Br', 16, 3],
      ['Kr', 17, 3], ['Rb', 0, 4], ['Sr', 1, 4], ['Y', 2, 4], ['Zr', 3, 4], ['Nb', 4, 4], ['Mo', 5, 4],
      ['Tc', 6, 4], ['Ru', 7, 4], ['Rh', 8, 4], ['Pd', 9, 4], ['Ag', 10, 4], ['Cd', 11, 4], ['In', 12, 4],
      ['Sn', 13, 4], ['Sb', 14, 4], ['Te', 15, 4], ['I', 16, 4], ['Xe', 17, 4], ['Cs', 0, 5], ['Ba', 1, 5],
      ['La', 3, 8], ['Ce', 4, 8], ['Pr', 5, 8], ['Nd', 6, 8], ['Pm', 7, 8], ['Sm', 8, 8], ['Eu', 9, 8],
      ['Gd', 10, 8], ['Tb', 11, 8], ['Dy', 12, 8], ['Ho', 13, 8], ['Er', 14, 8], ['Tm', 15, 8], ['Yb', 16, 8], ['Lu', 17, 8],
      ['Hf', 3, 5], ['Ta', 4, 5], ['W', 5, 5], ['Re', 6, 5], ['Os', 7, 5], ['Ir', 8, 5],
      ['Pt', 9, 5], ['Au', 10, 5], ['Hg', 11, 5], ['Tl', 12, 5], ['Pb', 13, 5], ['Bi', 14, 5], ['Po', 15, 5],
      ['At', 16, 5], ['Rn', 17, 5],
      ['Fr', 0, 6], ['Ra', 1, 6],
      ['Ac', 3, 9], ['Th', 4, 9], ['Pa', 5, 9], ['U', 6, 9], ['Np', 7, 9], ['Pu', 8, 9], ['Am', 9, 9],
      ['Cm', 10, 9], ['Bk', 11, 9], ['Cf', 12, 9], ['Es', 13, 9], ['Fm', 14, 9], ['Md', 15, 9], ['No', 16, 9], ['Lr', 17, 9],
      ['Rf', 3, 6], ['Db', 4, 6], ['Sg', 5, 6], ['Bh', 6, 6], ['Hs', 7, 6], ['Mt', 8, 6], ['Ds', 9, 6],
      ['Rg', 10, 6], ['Cn', 11, 6], ['Nh', 12, 6], ['Fl', 13, 6], ['Mc', 14, 6], ['Lv', 15, 6],
      ['Ts', 16, 6], ['Og', 17, 6]
    ];
    const numColunasGrid = 19;
    const numColunasElementos = 18;
    const numLinhasElementos = 10;
    const numLinhasTotal = 11;
    const grid = Array(numColunasGrid * numLinhasTotal).fill(null);

    elementos.forEach(([simbolo, grupo, periodo]) => {
        if (periodo >= 0 && periodo < numLinhasElementos) {
            if (grupo >= 0 && grupo < numColunasElementos) {
                const pos = grupo + numColunasGrid * periodo;
                if (pos >= 0 && pos < (numColunasGrid * numLinhasElementos)) { grid[pos] = simbolo; }
            }
        }
    });
    const linhaGrupoHeader = numLinhasTotal - 1;
    for (let i = 0; i < numColunasElementos; i++) {
        grid[i + numColunasGrid * linhaGrupoHeader] = `grupo-${i + 1}`;
    }
    const colPeriodoIndex = numColunasGrid - 1;
    for (let row = 0; row < 7; row++) {
        grid[colPeriodoIndex + numColunasGrid * row] = `periodo-${row + 1}`;
    }

    const containerTabela = document.getElementById('tabelaPeriodica');
    const zoomContainer = document.getElementById('zoom-container'); 
    const labelGrupoDiv = document.createElement('div');
    labelGrupoDiv.id = 'label-grupo';
    labelGrupoDiv.innerText = 'GRUPO';
    containerTabela.appendChild(labelGrupoDiv); 
    const labelPeriodoDiv = document.createElement('div');
    labelPeriodoDiv.id = 'label-periodo';
    labelPeriodoDiv.innerText = 'PERÍODO';
    containerTabela.appendChild(labelPeriodoDiv); 
    const elementoRefs = {};
    const contagemSorteios = {}; 
    const btnBingo = document.getElementById('bingoBtn');
    const somSorteando = document.getElementById('somSorteando');
    const somFinal = document.getElementById('somFinal');

    function createParticles() {
      const particlesContainer = document.getElementById('particles');
      if (!particlesContainer) return;
      const numParticles = 15;
      for (let i = 0; i < numParticles; i++) {
        const particle = document.createElement('div');
        particle.className = 'particle';
        particle.style.left = Math.random() * 100 + '%';
        particle.style.top = Math.random() * 100 + '%';
        particle.style.animationDelay = Math.random() * 6 + 's';
        particle.style.animationDuration = (Math.random() * 4 + 4) + 's';
        particlesContainer.appendChild(particle);
      }
    }

    document.addEventListener('keydown', function(event) {
      if (event.key === 'Enter' && !btnBingo.disabled) { btnBingo.click(); }
    });

    grid.forEach((conteudo) => {
      const div = document.createElement('div');
      if (conteudo && typeof conteudo === 'string' && !conteudo.startsWith('grupo-') && !conteudo.startsWith('periodo-')) {
        const simbolo = conteudo;
        div.className = 'elemento';
        const imgHTML = `<picture><source srcset="imagens/${simbolo}.webp" type="image/webp"><source srcset="imagens/${simbolo}.jpg" type="image/jpeg"><img src="imagens/${simbolo}.jpg" alt="${simbolo}" loading="lazy"></picture>`;
        div.innerHTML = `<div class="simbolo">${simbolo}</div><div class="foto-editavel">${imgHTML}</div>`;
        const fotoDiv = div.querySelector('.foto-editavel');
        if (fotoDiv) {
            fotoDiv.addEventListener('click', (e) => {
               e.stopPropagation();
               const pic = fotoDiv.querySelector('picture');
               mostrarDestaque(pic ? pic.outerHTML : fotoDiv.querySelector('img').outerHTML);
            });
        }
        containerTabela.appendChild(div);
        elementoRefs[simbolo] = div;
        contagemSorteios[simbolo] = 0; 
      } else if (conteudo && typeof conteudo === 'string' && conteudo.startsWith('grupo-')) {
          div.className = 'grupo-header'; div.innerText = conteudo.split('-')[1];
          containerTabela.appendChild(div);
      } else if (conteudo && typeof conteudo === 'string' && conteudo.startsWith('periodo-')) {
          div.className = 'periodo-numero'; div.innerText = conteudo.split('-')[1];
          containerTabela.appendChild(div);
      } else if (conteudo === null) {
        div.className = 'vazio'; containerTabela.appendChild(div);
      }
    });

    const originalTableWidth = (18 * 48) + (17 * 2) + 30;
    const originalCellHeight = 48 / 0.6547;
    const originalTableHeight = (7 * originalCellHeight) + 10 + (2 * originalCellHeight) + 25 + (10 * 2);
    const originalTitleFontSize = 18;
    const originalButtonFontSize = 14;
    const originalButtonPaddingV = 6;
    const originalButtonPaddingH = 12;

    function updateLayout() {
      const availableWidth = window.innerWidth;
      const availableHeight = window.innerHeight;
      const docStyle = document.documentElement.style;
      const titleDiv = document.querySelector('.titulo-flutuante');
      const titleHeight = titleDiv ? titleDiv.offsetHeight : 0;
      const topMargin = titleDiv ? parseFloat(getComputedStyle(titleDiv).top) : 0;
      const zoomContainerTop = titleHeight + topMargin + 30; 
      zoomContainer.style.top = zoomContainerTop + 'px';
      const heightForTableScaling = availableHeight - zoomContainerTop - 20;
      let scaleFactor = 1;
      if (originalTableWidth > 0 && originalTableHeight > 0) {
        const scaleFactorWidth = (availableWidth * 0.9) / originalTableWidth;
        const scaleFactorHeight = heightForTableScaling / originalTableHeight;
        scaleFactor = Math.min(scaleFactorWidth, scaleFactorHeight, 2.5); 
        scaleFactor = Math.max(0.4, scaleFactor);
      }
      zoomContainer.style.transform = `translateX(-50%) scale(${scaleFactor})`;
      docStyle.setProperty('--scaled-title-font-size', (originalTitleFontSize * Math.min(scaleFactor, 1.5)) + 'px');
      docStyle.setProperty('--scaled-title-padding-vertical', (8 * Math.min(scaleFactor, 1.5)) + 'px');
      docStyle.setProperty('--scaled-title-padding-horizontal', (16 * Math.min(scaleFactor, 1.5)) + 'px');
      docStyle.setProperty('--scaled-button-font-size', (originalButtonFontSize * Math.min(scaleFactor, 1.5)) + 'px');
      docStyle.setProperty('--scaled-button-padding-vertical', (6 * Math.min(scaleFactor, 1.5)) + 'px');
      docStyle.setProperty('--scaled-button-padding-horizontal', (12 * Math.min(scaleFactor, 1.5)) + 'px');
      const btnFlutuante = document.querySelector('.botao-flutuante');
      if (btnFlutuante && titleDiv) {
          btnFlutuante.style.top = `${topMargin + titleHeight + 15}px`;
      }
      requestAnimationFrame(drawArrows);
    }

    let resizeTimeout;
    window.addEventListener('resize', () => {
      clearTimeout(resizeTimeout);
      resizeTimeout = setTimeout(updateLayout, 150); 
    });
    
    function mostrarDestaque(conteudoHTML) {
      const overlayExistente = document.querySelector('.destaque-overlay');
      if(overlayExistente) {
        document.body.removeChild(overlayExistente);
        document.removeEventListener('keydown', gerenciarTeclasOverlay); 
      }
      const overlay = document.createElement('div');
      overlay.className = 'destaque-overlay';
      overlay.innerHTML = `<div class="destaque-box">${conteudoHTML}</div>`;
      document.body.appendChild(overlay);
      overlay.addEventListener('click', (event) => {
          if (event.target === overlay) {
              document.body.removeChild(overlay);
              document.removeEventListener('keydown', gerenciarTeclasOverlay);
          }
      });
      document.addEventListener('keydown', gerenciarTeclasOverlay);
    }
    
    function gerenciarTeclasOverlay(event) {
        if (event.key === 'Escape' || event.key === 'Enter') {
            const overlay = document.querySelector('.destaque-overlay');
            if (overlay) {
                document.body.removeChild(overlay);
                document.removeEventListener('keydown', gerenciarTeclasOverlay);
                if (event.key === 'Enter' && !btnBingo.disabled) {
                    btnBingo.click();
                }
            }
        }
    }

    btnBingo.addEventListener('click', () => { 
      const candidatos = Object.keys(elementoRefs).filter(sim => contagemSorteios[sim] < 2);
      if (candidatos.length === 0) {
        alert('Todos os elementos já foram sorteados duas vezes!');
        return;
      }
      btnBingo.disabled = true;
      let elementoAnimacao = null;
      let contadorAnimacao = 0;
      const maxAnimacoes = 15;
      const intervaloMs = 300;
      const intervaloSorteio = setInterval(() => {
        if (elementoAnimacao && elementoRefs[elementoAnimacao]) {
             elementoRefs[elementoAnimacao].classList.remove('sorteio-ativo');
        }
        let candidatosAnimacao = candidatos.filter(sim => sim !== elementoAnimacao);
        if (candidatosAnimacao.length === 0) candidatosAnimacao = candidatos;
        elementoAnimacao = candidatosAnimacao[Math.floor(Math.random() * candidatosAnimacao.length)];
        somSorteando.pause(); somSorteando.currentTime = 0;
        somSorteando.play().catch(e => console.error("Erro ao tocar somSorteando:", e));
        if (elementoRefs[elementoAnimacao]) {
             elementoRefs[elementoAnimacao].classList.add('sorteio-ativo');
        }
        contadorAnimacao++;
        if (contadorAnimacao >= maxAnimacoes) {
          clearInterval(intervaloSorteio);
          const elementoFinalSorteado = candidatos[Math.floor(Math.random() * candidatos.length)];
          setTimeout(() => {
            somSorteando.pause(); somSorteando.currentTime = 0;
            if (elementoAnimacao && elementoRefs[elementoAnimacao]) {
                elementoRefs[elementoAnimacao].classList.remove('sorteio-ativo');
            }
            somFinal.currentTime = 0;
            somFinal.play().catch(e => console.error("Erro ao tocar somFinal:", e));
            let timeoutSomFinal = setTimeout(() => {
              somFinal.pause(); somFinal.currentTime = 0;
              if (Object.keys(elementoRefs).filter(sim => contagemSorteios[sim] < 2).length > 0) {
                 btnBingo.disabled = false;
              } else {
                 console.log("Todos elementos sorteados 2x, botão permanece desabilitado.");
                 alert('Bingo! Todos os elementos foram sorteados duas vezes.');
              }
            }, 1200);
            if (elementoRefs[elementoFinalSorteado]) {
                contagemSorteios[elementoFinalSorteado]++;
                const elementoDiv = elementoRefs[elementoFinalSorteado];
                if (contagemSorteios[elementoFinalSorteado] === 1) {
                    elementoDiv.classList.add('sorteado-uma-vez');
                } else if (contagemSorteios[elementoFinalSorteado] === 2) {
                    elementoDiv.classList.remove('sorteado-uma-vez');
                    elementoDiv.classList.add('sorteado');
                }
                const pic = elementoDiv.querySelector('picture');
                mostrarDestaque(pic ? pic.outerHTML : elementoDiv.querySelector('img').outerHTML);
            } else {
                 console.error("Erro: Elemento sorteado não encontrado:", elementoFinalSorteado);
                 btnBingo.disabled = false;
                 if(timeoutSomFinal) clearTimeout(timeoutSomFinal);
                 somFinal.pause(); alert("Erro inesperado durante o sorteio.");
            }
          }, 150);
        }
      }, intervaloMs);
    });

    function drawArrows() {
        const svg = document.getElementById('arrow-svg');
        const table = document.getElementById('tabelaPeriodica'); 
        if (!svg || !table || typeof elementoRefs === 'undefined' || Object.keys(elementoRefs).length === 0) {
            return;
        }
        svg.innerHTML = `<defs><marker id="arrowhead" markerWidth="10" markerHeight="7" refX="8" refY="3.5" orient="auto" markerUnits="strokeWidth"><polygon points="0 0, 10 3.5, 0 7" /></marker></defs>`;
        const arrowGroup = document.createElementNS('http://www.w3.org/2000/svg', 'g');
        svg.appendChild(arrowGroup);
        const calculatePathPoints = (startSymbol, endSymbol, arrowIndex = 0) => {
            const startEl = elementoRefs[startSymbol]; const endEl = elementoRefs[endSymbol];
            if (!startEl || !endEl) return null;
            const startRect = startEl.getBoundingClientRect(); const endRect = endEl.getBoundingClientRect();
            const p1x = startRect.right; const p1y = startRect.top + startRect.height / 2;
            const refCellWidth = 48; const currentCellWidth = startRect.width;
            let extFactor = (arrowIndex === 0) ? (25 / refCellWidth) : (4 / refCellWidth);
            const horizExt = extFactor * currentCellWidth;
            const p2x = p1x + horizExt; const p2y = p1y;
            const p3x = p2x; const p3y = endRect.top + endRect.height / 2;
            const p4x = endRect.left; const p4y = p3y;
            return `M ${p1x} ${p1y} L ${p2x} ${p2y} L ${p3x} ${p3y} L ${p4x} ${p4y}`;
        };
        const 그려Path = (pathData) => { 
            if (!pathData) return;
            const path = document.createElementNS('http://www.w3.org/2000/svg', 'path');
            path.setAttribute('d', pathData); path.setAttribute('marker-end', 'url(#arrowhead)');
            arrowGroup.appendChild(path);
        };
        if (elementoRefs['Ba'] && elementoRefs['La']) 그려Path(calculatePathPoints('Ba', 'La', 0));
        if (elementoRefs['Ra'] && elementoRefs['Ac']) 그려Path(calculatePathPoints('Ra', 'Ac', 1));
    }
    
    document.addEventListener('DOMContentLoaded', () => {
      createParticles();
      updateLayout();
      requestAnimationFrame(drawArrows); 
    });
  </script>
</body>
</html>